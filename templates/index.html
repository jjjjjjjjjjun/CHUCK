<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>신비로운 이세계 동화 서고</title>
  <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Nanum+Myeongjo:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --magic-gold: #ffd700;
      --magic-purple: #4b0082;
      --parchment: #f4e4bc;
    }

    body {
      background-color: #1a1a2e; /* 깊은 밤의 색 */
      background-image: radial-gradient(circle, #2e1a47 0%, #1a1a2e 100%);
      color: var(--parchment);
      font-family: 'Gamja Flower', cursive;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      overflow-x: hidden;
    }

    .book-container {
      background-color: var(--parchment);
      background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
      color: #3e2723;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 0 50px rgba(0,0,0,0.8), inset 0 0 100px rgba(139, 69, 19, 0.2);
      max-width: 600px;
      width: 90%;
      border: 8px double #8b4513;
      position: relative;
      text-align: center;
    }

    h2 {
      font-family: 'Nanum Myeongjo', serif;
      font-size: 2.5rem;
      margin-bottom: 20px;
      color: var(--magic-purple);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    h2::before { content: "✨ "; }
    h2::after { content: " ✨"; }

    .input-group {
      margin-bottom: 30px;
    }

    input#concept {
      width: 80%;
      padding: 12px;
      border: none;
      border-bottom: 2px solid #8b4513;
      background: transparent;
      font-family: 'Gamja Flower', cursive;
      font-size: 1.2rem;
      outline: none;
      color: #5d4037;
      text-align: center;
    }

    button {
      background: var(--magic-purple);
      color: var(--magic-gold);
      border: 2px solid var(--magic-gold);
      padding: 10px 25px;
      font-size: 1.3rem;
      font-family: 'Gamja Flower', cursive;
      cursor: pointer;
      border-radius: 50px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      margin-top: 15px;
    }

    button:hover {
      transform: scale(1.1) rotate(-2deg);
      box-shadow: 0 0 20px var(--magic-gold);
      background: #5e00a3;
    }

    #output {
      margin-top: 30px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 5px;
      border: 1px dashed #8b4513;
      min-height: 100px;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 1.1rem;
      line-height: 1.6;
      text-align: left;
      color: #2c1e1e;
    }

    /* 반짝이는 마법 효과 애니메이션 */
    .magic-sparkle {
      position: absolute;
      pointer-events: none;
      background: white;
      border-radius: 50%;
      opacity: 0;
      animation: sparkle 1s linear;
    }

    @keyframes sparkle {
      0% { transform: scale(0); opacity: 1; }
      100% { transform: scale(1.5); opacity: 0; }
    }
  </style>
</head>
<body>

<div class="book-container">
  <h2>마법사의 이야기 보따리</h2>
  <p>그대가 상상하는 세계의 파편을 입력해주오...</p>

  <div class="input-group">
    <input id="concept" placeholder="예: 구름 위를 걷는 고양이" />
    <br>
    <button onclick="generateMagic()">이야기 소환하기</button>
  </div>

  <div id="output">이곳에 마법 같은 이야기가 기록됩니다...</div>
</div>

<script>
async function generateMagic() {
  const concept = document.getElementById("concept").value;
  const output = document.getElementById("output");

  if(!concept) {
    output.textContent = "소환할 이야기의 씨앗(컨셉)이 필요하다네!";
    return;
  }

  // 마법이 영글어가는 동안의 메시지
  output.style.opacity = "0.5";
  output.textContent = "수정구슬을 통해 미래를 읽는 중이니 잠시만 기다려 주오...";

  try {
    const res = await fetch("http://127.0.0.1:5000/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ concept })
    });

    const data = await res.json();

    // 마법사의 조언: 백엔드에서 'story'라는 키로 이야기를 보낸다고 가정합니다.
    // 만약 전체가 문자열이라면 data를 바로 쓰고, 객체라면 핵심 내용만 추출합니다.
    output.style.opacity = "1";

    if (data.story) {
        output.textContent = data.story;
    } else if (typeof data === 'string') {
        output.textContent = data;
    } else {
        // JSON 형태일 경우 가장 첫 번째 값이나 핵심 내용을 문장으로 출력
        const firstKey = Object.keys(data)[0];
        output.textContent = data[firstKey];
    }

  } catch (error) {
    output.style.opacity = "1";
    output.textContent = "오 이런! 마법 기류가 불안정하여 이야기를 불러오지 못했네. 다시 한 번 주문을 외워보겠나?";
  }
}
</script>

</body>
</html>